* { box-sizing: border-box; font: var(--fs-12)/1.5 var(--font-mono); }
html, body { height: 100%; }
body { margin: 0; background: var(--bg); color: var(--fg); display:grid; grid-template-rows: auto 1fr; }
.header { display:flex; align-items:center; gap: var(--pad-12); padding: var(--pad-4) var(--pad-16); border-bottom:1px solid rgba(var(--green-rgb),.3); position: sticky; top: 0; z-index: 100; background: var(--bg); min-height: 40px; }
.top-loader { position:absolute; left:0; right:0; top:0; height: 2px; background: linear-gradient(90deg, transparent, var(--fg), transparent); box-shadow: 0 0 8px rgba(var(--green-rgb),.5); animation: header-scan 1.1s linear infinite; }
@keyframes header-scan { from { background-position-x: 0; } to { background-position-x: 200%; } }
.view-tip, .view-tip .tip-text, .view-tip .btn { display: none !important; }
.logo { font-weight:700; }
.header-controls { display:grid; align-items:center; gap:12px 16px; min-width:0; flex:1; grid-template-columns: auto 1fr auto var(--col-right); }
.header-controls .mode-chips { grid-column: 1; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.header-controls .preset-bar { grid-column: 2; flex: 1 1 auto; min-width: 320px; overflow-x:auto; }
.header-controls .more { grid-column: 3; justify-self:end; }
.header-controls .search-wrapper { grid-column: 4; display:flex; align-items:center; gap:6px; margin-left:0; width: var(--col-right); }
.header-search { width: 100%; }
.preset-bar { display:flex; align-items:center; gap: var(--pad-8); overflow-x:auto; padding: var(--pad-4) 0; min-width:0; }
.header-controls .mode-chips { display:flex; align-items:center; gap:8px; flex-wrap:wrap; min-width:0; order: 1; }
.header-controls .preset-bar { order: 2; flex: 1 1 auto; min-width: 160px; }
.header-controls .search-wrapper { order: 3; display:flex; align-items:center; gap:6px; margin-left:auto; width: var(--col-right); }
.preset-bar::-webkit-scrollbar{ height:6px }
.preset-bar::-webkit-scrollbar-thumb{ background: rgba(var(--green-rgb),.25) }
.header .preset-btn,
.header select,
.header input[type="search"],
.header .clear-btn { height: var(--ctl-h); line-height: var(--ctl-h); }
.preset-btn { display:inline-flex; align-items:center; gap:6px; }
.preset-btn i { font-size: 14px; margin-right: 0; vertical-align: -2px; }
.preset-btn .preset-label { display:inline !important; }

/* Pro-level button hovers (aligned to maker/dash style) */
.preset-btn:hover, .chip-btn:hover, .tab-btn:hover, .btn:hover, .clear-btn:hover {
  background: var(--fg);
  color: #000;
  box-shadow: 0 0 16px rgba(var(--green-rgb), 0.5);
}
.preset-btn:active, .chip-btn:active, .tab-btn:active, .btn:active, .clear-btn:active {
  transform: translateY(1px) scale(0.985);
  box-shadow: 0 0 0 1px rgba(var(--green-rgb), .35), 0 0 8px rgba(var(--green-rgb), .25) inset;
}
.clear-btn { background: var(--bg); color: var(--fg); border: 1px solid rgba(var(--green-rgb),.2); padding: 0 var(--pad-8); cursor: pointer; }
.main-container {
  display: grid;
  grid-template-columns: var(--col-left) 1fr var(--col-right);
  height: calc(100dvh - 48px);
}
/* When header wraps to multiple rows, avoid clipping content by allowing extra height */
@media (max-width: 1200px){
  .main-container { height: auto; min-height: calc(100dvh - 40px); }
  .header-controls { grid-template-columns: 1fr auto; }
  .header-controls .mode-chips { grid-column: 1 / span 2; }
  .header-controls .preset-bar { grid-column: 1 / span 2; min-width: 0; }
  .header-controls .more { grid-column: 2; }
  .header-controls .search-wrapper { grid-column: 1; width: 100%; }
}
.controls-min { display:flex; align-items:center; gap: var(--pad-16); flex:1; }
.controls-min label { margin-right: var(--pad-12); color: var(--fg); }
.controls-min select, .controls-min input[type="search"], .left-panel select, .left-panel input[type="search"] {
  background: var(--bg); color: var(--fg); border: var(--border);
  padding: var(--ctl-pad-y) var(--ctl-pad-x); outline:none; height: var(--ctl-h); line-height: var(--ctl-h);
}
.left-panel select { appearance:none; -webkit-appearance:none; -moz-appearance:none; padding-right: 28px; background: var(--bg); color: var(--fg); border: var(--border); }
.mode-selector { position: relative; display:flex; align-items:center; gap: var(--pad-8); }
.mode-selector .select-caret { display:none; }
/* Unified select caret via background SVG */
select {
  -webkit-appearance: none; -moz-appearance: none; appearance: none;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'><path fill='%2300ff66' d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right var(--pad-8) center;
  background-size: 12px 12px;
  padding-right: calc(var(--ctl-pad-x) + 18px);
}
@media (min-width: 901px){ .mode-selector { display:none; } }
.header-search { background: var(--bg); color: var(--fg); border: var(--border); padding:6px 12px; outline:none; width:100%; }
.header-search::placeholder { color: rgba(var(--green-rgb),.6); font-size: var(--fs-10); }
.presets { display:flex; gap: var(--pad-6); }
.preset-btn { background: transparent; color: var(--fg); border: 1px solid rgba(var(--green-rgb),.35); padding:2px 10px; cursor:pointer; font-size: var(--fs-10); border-radius: 999px; opacity:.9; }
.preset-btn i { font-size:12px; vertical-align:middle; }
.preset-btn:hover { background: rgba(var(--green-rgb),.1); opacity:1; }
.preset-btn.active { background: var(--fg); color:#000; border-color: var(--fg); }
.shell { display:grid; grid-template-columns: 280px 1fr 420px; height:100%; overflow:hidden; }
.left-panel { border-right:1px solid rgba(var(--green-rgb),.2); padding: var(--pad-16); overflow:auto; width:var(--col-left); }
.left-panel, .right-panel { scrollbar-width: thin; scrollbar-color: rgba(var(--green-rgb), .4) rgba(var(--green-rgb), .08); }
.left-panel::-webkit-scrollbar, .right-panel::-webkit-scrollbar { width: 8px; height: 8px; }
.left-panel::-webkit-scrollbar-thumb, .right-panel::-webkit-scrollbar-thumb { background: rgba(var(--green-rgb), .35); border: 1px solid rgba(0,0,0,.5); }
.left-panel::-webkit-scrollbar-track, .right-panel::-webkit-scrollbar-track { background: rgba(var(--green-rgb), .08); }
.panel-title { color:rgba(var(--green-rgb),.6); margin: var(--pad-12) 0 var(--pad-6); }
.view-selector .panel-title { cursor: default; border: none; background: transparent; }
#traits-container { display:block; }
.trait-group { margin-bottom: var(--pad-6); border-bottom:1px solid rgba(var(--green-rgb),.05); }
.trait-header { color: var(--fg); font-weight:700; padding:2px 0; font-size: var(--fs-10); cursor:pointer; display:flex; align-items:center; gap:6px; }
.trait-header .twist { display:inline-block; width:8px; text-align:center; opacity:.6; }
.trait-values { display:none; margin: var(--pad-4) 0 var(--pad-8); }
.trait-value { padding:2px 4px; cursor:pointer; font-size: var(--fs-10); display:flex; justify-content:space-between; }
.trait-value:hover { background:rgba(var(--green-rgb),.1); }
.trait-value.active { background:rgba(var(--green-rgb),.2); color:var(--fg); }
.trait-count { opacity:.5; }
#stage { width:100%; height:100%; display:block; background: var(--bg); }
.center-panel { overflow:hidden; padding: var(--pad-16); }
.right-panel {
  width:var(--col-right);
  border-left:1px solid rgba(var(--green-rgb),.2);
  padding: var(--pad-16);
  overflow:auto;
  /* Compact typography and spacing scoped to right panel */
  --fs-14: 12px;
  --fs-12: 11px;
  --fs-10: 9px;
  --pad-16: 12px;
  --pad-12: 8px;
  --pad-8: 6px;
}
.right-panel #details { word-break: break-all; overflow-wrap: anywhere; padding: var(--pad-12); border: 1px solid rgba(var(--green-rgb), .12); background: rgba(0,0,0,.2); }
.right-panel img#thumb { width:100%; max-width:100%; height:auto; object-fit: contain; display:block; margin:0 auto var(--pad-12); border:1px solid rgba(var(--green-rgb),.2); }
.right-panel .grid { display:grid; grid-template-columns: 100px 1fr; gap: var(--pad-4) var(--pad-8); }
.right-panel .label { opacity:.75; font-size: var(--fs-10); color:rgba(var(--green-rgb),.7); text-transform:uppercase; }
.panel-title { font-weight:700; font-size: var(--fs-14); color: var(--fg); text-transform:uppercase; }
.section-label { font-size: var(--fs-10); color: rgba(var(--green-rgb), .65); text-transform:uppercase; opacity:.9; margin: var(--pad-8) 0 var(--pad-4); }
.big-number { font-weight:700; font-size: var(--fs-14); color: var(--fg); text-transform:none; }
.data-value { font-size: var(--fs-12); color: var(--text); }
.small-meta { font-size: var(--fs-10); color:#7dd9a3; }
.card2 { display:grid; grid-template-columns: 1fr 1fr; gap: var(--pad-12); margin: var(--pad-12) 0; }
.card { border:1px solid rgba(var(--green-rgb),.15); padding: var(--pad-8); background: var(--card-bg); }
.token-title { font-weight:700; font-size: var(--fs-14); color: var(--fg); text-transform:uppercase; display:flex; justify-content:space-between; align-items:center; }
.token-close { cursor:pointer; border:1px solid rgba(var(--green-rgb),.3); padding:0 var(--pad-6); height:18px; line-height:18px; }
.ens-name { font-weight:500; font-size:14px; color: var(--text); }
.address { font-family: var(--font-mono); font-size: var(--fs-12); color: rgba(var(--green-rgb), .7); }
.traits-table { display:grid; grid-template-columns: 1fr 1fr; gap: var(--pad-4) var(--pad-8); border:1px solid rgba(var(--green-rgb),.1); padding: var(--pad-8); }
.chip-row { display:flex; flex-wrap:wrap; gap: var(--pad-6); }
.chip { border:1px solid rgba(var(--green-rgb),.3); padding:2px 6px; font-size: var(--fs-10); cursor:pointer; }
.legend { font-size:10px; line-height:1.4; opacity:.85; color: var(--fg-dim); margin: var(--pad-8) var(--pad-4) var(--pad-8) 0; display:block; white-space: normal; }

/* Keep view-tip reserved height even when hidden to avoid layout jump */
.view-tip[hidden] { display:block !important; visibility:hidden; padding: 0 var(--pad-12); min-height: 24px; border-bottom: 1px dashed transparent; }

/* Left panel view tabs side-by-side */
.view-tabs { display:grid; grid-template-columns: repeat(5, 1fr); gap: var(--pad-6); margin-bottom: var(--pad-8); }
.tab-btn { width:100%; border: var(--border); background: var(--bg); color: var(--fg); padding: 4px 8px; cursor: pointer; }

/* Detail panel text normalization */
.right-panel .ens-name,
.right-panel .address,
.right-panel .data-value,
.right-panel .small-meta { text-transform:none; }

/* Brand form controls */
input[type="checkbox"] { accent-color: var(--fg); }
.layer-toggle input[type="checkbox"] {
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  width: 16px; height: 16px; border: 1px solid var(--fg); background: transparent; position: relative; cursor: pointer;
}
.layer-toggle input[type="checkbox"]:checked { background: rgba(var(--green-rgb), .15); }
.layer-toggle input[type="checkbox"]:checked::after {
  content: '\2713'; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-58%); color: var(--fg); font-size: 12px; line-height: 1;
}
/* Consistent focus styles */
:where(input[type="search"], select, textarea, button, .preset-btn, .chip-btn, .clear-btn):focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px rgba(var(--green-rgb), .35);
}
.layer-toggle input[type="checkbox"]:focus-visible { outline: none; box-shadow: 0 0 0 2px rgba(var(--green-rgb), .35); }
.edge-controls input[type=range]:focus-visible { outline: none; box-shadow: 0 0 0 2px rgba(var(--green-rgb), .25); }

/* Brand tooltips for icon-only controls (desktop only) */
@media (hover: hover) and (pointer: fine){
  .tooltipped[data-tooltip] { position: relative; }
  .tooltipped[data-tooltip]:hover::after,
  .tooltipped[data-tooltip]:focus-visible::after {
    content: attr(data-tooltip);
    position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%);
    background: var(--bg); color: var(--fg); border: var(--border);
    padding: var(--pad-4) var(--pad-6); white-space: nowrap; z-index: 300;
    font-size: var(--fs-10); opacity: 1; transition: opacity 200ms ease;
  }
  .tooltipped[data-tooltip]::after{ opacity: 0; pointer-events:none; }
  .tooltipped[data-tooltip]:hover::before,
  .tooltipped[data-tooltip]:focus-visible::before {
    content: '';
    position: absolute; bottom: calc(100% + 2px); left: 50%; transform: translateX(-50%);
    width: 0; height: 0; z-index: 301;
    border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 6px solid var(--bg);
    /* border outline */
    box-shadow: 0 -1px 0 0 rgba(var(--green-rgb), .25);
  }
}
.edge-controls input[type=range] {
  width: 180px;
  appearance: none; height: 6px; background: rgba(var(--green-rgb), .25); border: var(--border);
}
.edge-controls input[type=range]::-webkit-slider-thumb { appearance:none; width:14px; height:14px; border-radius:50%; background: var(--fg); border: 1px solid rgba(0,0,0,.6); box-shadow: 0 0 8px rgba(var(--green-rgb),.35); margin-top: -4px; }
.edge-controls input[type=range]::-moz-range-thumb { width:14px; height:14px; border-radius:50%; background: var(--fg); border: 1px solid rgba(0,0,0,.6); box-shadow: 0 0 8px rgba(var(--green-rgb),.35); }
.edge-controls input[type=range]::-webkit-slider-runnable-track { height:6px; background: rgba(var(--green-rgb), .25); }
.edge-controls input[type=range]::-moz-range-track { height:6px; background: rgba(var(--green-rgb), .25); }

@media (max-width: 1200px){
  .header-controls .preset-bar { order: 2; flex: 1 1 100%; }
  .header-controls .search-wrapper { order: 3; flex: 1 1 100%; justify-content: flex-start; }
  .header-search { width: 100%; }
}

@media (max-width: 900px){
.preset-bar { max-width: 100%; gap: var(--pad-6); }
  .preset-btn { padding: 2px 6px; font-size: 10px; }
  .mode-chips { gap:6px; display:none; }
  .chip-btn { padding: 2px var(--pad-6); font-size: 10px; }
  .main-container { grid-template-columns: 1fr; height: auto; }
  .right-panel { width:auto; }
}

@media (max-width: 600px){
  .preset-bar { gap: var(--pad-4); }
  .mode-chips { display:none; }
  .chip-btn { background: var(--bg); color: var(--fg); border: var(--border); padding: var(--pad-4) var(--pad-8); height: var(--ctl-h); line-height: 22px; cursor:pointer; display:flex; align-items:center; gap: var(--pad-6); }
  .chip-btn i { font-size: 14px; }
  .chip-btn.active { background: var(--fg); color:#000; box-shadow: 0 0 12px rgba(var(--green-rgb), .35); }
.left-panel .controls-section { display:flex; flex-direction:column; gap: var(--pad-12); }
.layer-toggles { display:flex; flex-direction:column; gap: var(--pad-12); }
.edge-controls { display:flex; align-items:center; gap: var(--pad-12); }
  .preset-btn { padding: 2px 4px; }
  .preset-btn .preset-label { display:none; }
  .preset-btn i { margin-right: 0; }
  .chip-btn { padding: 2px 4px; }
  .chip-btn .chip-label { display:none; }
}

/* Layer toggle active outline */
.layer-toggle { display:flex; align-items:center; justify-content: space-between; gap:8px; padding: 4px 6px; border: 1px solid transparent; border-radius: 4px; }
.layer-toggle.active { border-color: var(--fg); box-shadow: 0 0 8px rgba(var(--green-rgb), .25); }
.right-panel #details { word-break: break-all; overflow-wrap: anywhere; }

/* Intermediate layout breakpoint for tablets */
@media (max-width: 1024px){
  .main-container { grid-template-columns: 240px 1fr 360px; }
  .center-panel { padding: var(--pad-12); }
}

/* Additional tablet/mobile breakpoint */
@media (max-width: 768px){
  :root { --ctl-h: 44px; }
  .header-controls { gap: var(--pad-8); flex-direction: column; align-items: stretch; }
  .view-selector select { width: 100%; }
  .search-wrapper { width: 100%; }
  .header-search { width: 100%; }
  .left-panel, .right-panel { scrollbar-width: auto; }
}

/* Traits collapsible */
.traits-section { border-top: 1px solid rgba(var(--green-rgb), .15); padding-top: var(--pad-12); }
.traits-header { display:flex; align-items:center; gap: var(--pad-8); cursor:pointer; }
.traits-header .twist { display:inline-block; width: 10px; transition: transform 200ms ease; }
.traits-section .traits-body { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 200ms ease, opacity 200ms ease; }
.traits-section.open .traits-body { max-height: 1200px; opacity: 1; }
.traits-section.open .traits-header .twist { transform: rotate(90deg); }

/* Edge layer groups */
.edge-groups { display:flex; flex-direction:column; gap: var(--pad-8); }
.edge-group { border: 1px solid rgba(var(--green-rgb), .15); padding: var(--pad-8); background: var(--card-bg); }
.edge-group-header { display:flex; align-items:center; justify-content: space-between; cursor:pointer; font-size: var(--fs-10); text-transform: uppercase; color: rgba(var(--green-rgb), .7); }
.edge-group-header:focus-visible, .traits-header:focus-visible { box-shadow: 0 0 0 2px rgba(var(--green-rgb), .35); outline: none; }
.edge-group-header .twist { opacity: .8; transition: transform 200ms ease; }
.edge-group-body { max-height: 0; overflow:hidden; opacity: 0; transition: max-height 200ms ease, opacity 200ms ease; display:grid; grid-template-columns: 1fr; gap: var(--pad-6); margin-top: var(--pad-8); }
.edge-group.open .edge-group-body { max-height: 1200px; opacity: 1; }
.edge-group.open .edge-group-header .twist { transform: rotate(90deg); }

/* Reduced motion preferences: disable UI transitions/animations */
@media (prefers-reduced-motion: reduce){
  .traits-section .traits-body,
  .edge-group-body { transition: none !important; }
  .traits-header .twist,
  .edge-group-header .twist { transition: none !important; }
}

/* Consolidated button patterns */
.btn, .preset-btn, .chip-btn, .clear-btn {
  background: var(--bg); color: var(--fg); border: var(--border);
  padding: var(--pad-4) var(--pad-8); cursor:pointer; font-size: var(--fs-10);
}
.btn:hover, .preset-btn:hover, .chip-btn:hover, .clear-btn:hover { background: rgba(var(--green-rgb), .1); }
.btn.active, .preset-btn.active, .chip-btn.active { background: var(--fg); color:#000; box-shadow: 0 0 12px rgba(var(--green-rgb), .35); }

/* Modifiers (present for semantics; currently align to base) */
.btn--preset {}
.btn--chip {}
.btn--clear {}

/* Scoped letter-spacing for uppercase UI elements */
.preset-btn, .chip-btn, .panel-title, .section-label, .right-panel .label, .token-title { letter-spacing: .06em; }
/* Unified view selector */
.view-selector { display:flex; align-items:center; gap: var(--pad-8); }
.view-selector label { font-size: var(--fs-12); opacity: .95; letter-spacing: .06em; }
.view-selector select { min-width: 280px; font-size: var(--fs-12); background: var(--bg); color: var(--fg); border: var(--border); }
/* Header placement spacing is handled via parent; left panel variant uses full width */
.left-panel .panel-view { display:flex; flex-direction: column; gap: var(--pad-8); margin-bottom: var(--pad-12); }
.left-panel .panel-view select { width: 100%; }
.view-tabs { display:flex; flex-direction: column; gap: var(--pad-8); }
.tab-btn { background: var(--bg); color: var(--fg); border: var(--border); padding: var(--pad-6) var(--pad-8); height: var(--ctl-h); cursor:pointer; letter-spacing:.06em; }
.tab-btn:hover { background: rgba(var(--green-rgb), .1); }
.tab-btn.active { background: var(--fg); color: #000; box-shadow: 0 0 12px rgba(var(--green-rgb), .35); }
.sr-only { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }

/* Hide redundant controls when unified views are present */
body.view-selector-enabled .mode-chips,
body.view-selector-enabled .preset-bar { display: none; }

/* Mobile overflow menu */
.header .more { position: relative; display: none; }
.more-panel {
  position: absolute; right: 0; top: calc(100% + 6px); z-index: 200;
  background: var(--bg); border: var(--border); min-width: 180px; padding: var(--pad-6);
}
.more-panel .menu-item {
  display:block; width:100%; text-align:left; background: var(--bg); color: var(--fg);
  border: var(--border); padding: var(--pad-6) var(--pad-8); margin-bottom: var(--pad-6);
  font-size: var(--fs-12); cursor:pointer;
}
.more-panel .menu-item:last-child { margin-bottom: 0; }
.more-panel .menu-item:hover, .more-panel .menu-item:focus { background: rgba(var(--green-rgb), .1); outline: none; }

@media (max-width: 768px){
  .header .more { display: block; }
  /* Stronger active feedback for icon-only buttons on touch */
  .btn:active { background: rgba(var(--green-rgb), .15); }
}
.tab-btn { border: var(--border); background: var(--bg); color: var(--fg); padding: 4px 6px; cursor:pointer; }
.tab-btn:hover { background: var(--fg); color:#000; box-shadow: 0 0 12px rgba(var(--green-rgb), .45); }
.tab-btn:active { transform: translateY(1px) scale(0.985); box-shadow: 0 0 0 1px rgba(var(--green-rgb), .35), 0 0 8px rgba(var(--green-rgb), .25) inset; }
