/* Global Reset */
* { box-sizing: border-box; font: var(--fs-12)/1.5 var(--font-mono); }
html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); }
body { display: grid; grid-template-rows: auto 1fr; min-height: 100dvh; }

a { color: inherit; text-decoration: none; }
button { font: inherit; }

/* Header */
.header {
  display: grid;
  grid-template-columns: var(--col-left) 1fr var(--col-right);
  align-items: center;
  border-bottom: 1px solid rgba(var(--green-rgb), .3);
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg);
  height: 40px;
  min-height: 40px;
}
.top-loader {
  position: absolute;
  left: 0; right: 0; top: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--fg), transparent);
  box-shadow: 0 0 6px rgba(var(--green-rgb), .35);
  opacity: .85;
  animation: header-scan 1.6s linear infinite;
}
@keyframes header-scan { from { background-position-x: 0; } to { background-position-x: 200%; } }

.logo-wrap { display: flex; align-items: center; gap: var(--pad-8); padding-left: var(--pad-16); }
.logo {
  font-weight: 700;
  font-size: var(--fs-18);
  font-family: 'Fira Code', var(--font-mono);
  animation: logo-glow 3s ease-in-out infinite;
}
@keyframes logo-glow { 0%,100% { text-shadow: 0 0 6px rgba(var(--green-rgb), .35); } 50% { text-shadow: 0 0 14px rgba(var(--green-rgb), .65); } }
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--fg); box-shadow: 0 0 8px rgba(var(--green-rgb), .75); }

.header-controls {
  grid-column: 2 / 4;
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: center;
  gap: var(--pad-16);
  padding-right: var(--pad-16);
  min-width: 0;
}
.header-actions { position: relative; display: flex; align-items: center; justify-content: flex-end; gap: var(--pad-8); }

#search {
  grid-column: 2;            /* was 3 */
  justify-self: start;       /* align left */
  width: var(--col-left);    /* cap to left panel width */
  max-width: var(--col-left);
  margin: 0;                 /* remove extra right margin */
  height: var(--ctl-h);
  padding: 0 var(--pad-8);
  background: #000;
  color: #d9ffe9;
  border: 1px solid rgba(0, 255, 102, .25);
  font: var(--fs-12)/1 var(--font-mono);
}

/* Buttons & Controls */
.btn, .preset-btn, .chip-btn, .clear-btn, .menu-item {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--pad-6);
  height: var(--ctl-h);
  min-height: var(--ctl-h);
  padding: 0 var(--pad-12);
  background: var(--bg);
  color: var(--fg);
  border: var(--border);
  cursor: pointer;
  transition: background 160ms ease, color 160ms ease, box-shadow 160ms ease;
}
.btn:hover, .preset-btn:hover, .chip-btn:hover, .clear-btn:hover, .menu-item:hover {
  background: rgba(var(--green-rgb), .1);
  box-shadow: 0 0 12px rgba(var(--green-rgb), .35);
}
.btn.active { background: var(--fg); color: #000; }
.menu-item { width: 100%; justify-content: flex-start; }

select, input[type="range"], input[type="search"], input[type="text"], input[type="number"] {
  background: var(--bg);
  color: var(--fg);
  border: var(--border);
  padding: 0 var(--pad-8);
  height: var(--ctl-h);
  min-height: var(--ctl-h);
}
select { appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='8' viewBox='0 0 14 8'><path fill='%2300ff66' d='M7 8 0 0h14z'/></svg>"); background-repeat: no-repeat; background-position: right var(--pad-8) center; padding-right: calc(var(--pad-16) + 14px); }
input[type="range"] { width: 100%; appearance: none; height: 6px; background: rgba(var(--green-rgb), .25); border: 1px solid rgba(var(--green-rgb), .3); }
input[type="range"]::-webkit-slider-thumb { appearance: none; width: 14px; height: 14px; border-radius: 50%; background: var(--fg); border: 1px solid rgba(0,0,0,.6); box-shadow: 0 0 8px rgba(var(--green-rgb), .35); }
input[type="range"]::-moz-range-thumb { width: 14px; height: 14px; border-radius: 50%; background: var(--fg); border: 1px solid rgba(0,0,0,.6); box-shadow: 0 0 8px rgba(var(--green-rgb), .35); }

input[type="checkbox"]{
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid var(--fg);
  background: transparent;
  position: relative;
  cursor: pointer;
}
input[type="checkbox"]:checked{ background: rgba(var(--green-rgb), .15); }
input[type="checkbox"]:checked::after{
  content: '\2713';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-58%);
  color: var(--fg);
  font-size: var(--fs-12);
  line-height: 1;
}

/* Layout */
.main-container {
  display: grid;
  grid-template-columns: var(--col-left) 1fr var(--col-right);
  height: calc(100vh - 40px);
  min-height: calc(100dvh - 40px);
}
.left-panel, .right-panel {
  position: relative;
  z-index: 2;
  background: var(--bg);
  padding: var(--pad-16);
  overflow: auto;
}
.left-panel { border-right: 1px solid rgba(var(--green-rgb), .2); }
.right-panel { width: var(--col-right); border-left: 1px solid rgba(var(--green-rgb), .2); }
.center-panel { position: relative; z-index: 1; overflow: hidden; }

.controls-section { display: flex; flex-direction: column; gap: var(--pad-16); }
.panel-title { font-size: var(--fs-14); font-weight: 700; letter-spacing: .1em; display: block; }
.edge-controls, .layer-toggles { display: flex; align-items: center; gap: var(--pad-8); flex-wrap: wrap; }
.edge-controls label { min-width: 72px; }
.layer-toggles { flex-direction: column; align-items: stretch; gap: var(--pad-6); }
.layer-toggle { display: flex; align-items: center; justify-content: space-between; gap: var(--pad-8); }
.layer-toggle label { text-transform: uppercase; font-size: var(--fs-10); letter-spacing: .08em; }

.view-buttons {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--pad-6);
  margin-top: var(--pad-8);
}

.view-btn {
  border: var(--border);
  background: var(--card-bg);
  color: var(--fg);
  padding: var(--pad-8);
  text-align: left;
  font-size: var(--fs-11);
  text-transform: uppercase;
  letter-spacing: .08em;
  cursor: pointer;
  transition: background 160ms ease, box-shadow 160ms ease;
}

.view-btn.active {
  background: rgba(var(--green-rgb), .15);
  box-shadow: 0 0 10px rgba(var(--green-rgb), .35);
}

.colors { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: var(--pad-6); font-size: var(--fs-10); text-transform: uppercase; }
.sw { display: inline-block; width: 10px; height: 10px; border-radius: 2px; margin-right: var(--pad-6); box-shadow: 0 0 6px rgba(var(--green-rgb), .4); }
.sw--active { background: var(--fg); }
.sw--whale { background: var(--fg-bright); }
.sw--frozen { background: var(--blue); }
.sw--dormant { background: var(--gray); }

/* Collapsibles */
.edge-groups, .traits-section { display: flex; flex-direction: column; gap: var(--pad-8); }
.edge-group, .traits-section { border: 1px solid rgba(var(--green-rgb), .15); background: var(--card-bg); padding: var(--pad-12); }
.edge-group-header, .traits-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  text-transform: uppercase;
  font-size: var(--fs-10);
  letter-spacing: .08em;
}
.edge-group-header .twist, .traits-header .twist { transition: transform 200ms ease; }
.edge-group-body, .traits-body {
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: max-height 220ms ease, opacity 220ms ease;
  margin-top: var(--pad-12);
  display: grid;
  gap: var(--pad-6);
}
.edge-group.open .edge-group-body, .traits-section.open .traits-body { max-height: 1200px; opacity: 1; }
.edge-group.open .edge-group-header .twist, .traits-section.open .traits-header .twist { transform: rotate(90deg); }

/* Right Panel */
#thumb { width: 100%; max-width: 100%; border: 1px solid rgba(var(--green-rgb), .15); margin-bottom: var(--pad-12); }
#details { border: 1px solid rgba(var(--green-rgb), .12); background: rgba(0,0,0,.2); padding: var(--pad-16); word-break: break-word; }
.card { border: 1px solid rgba(var(--green-rgb), .15); background: var(--card-bg); padding: var(--pad-8); }
.card2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: var(--pad-12); margin: var(--pad-12) 0; }
.token-title {
  font-size: var(--fs-14);
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.big-number {
  font-size: var(--fs-12);
  font-weight: 700;
}
.section-label { margin: var(--pad-12) 0 var(--pad-6); font-size: var(--fs-10); text-transform: uppercase; letter-spacing: .08em; color: rgba(var(--green-rgb), .65); }
.label { font-size: var(--fs-10); text-transform: uppercase; letter-spacing: .08em; color: rgba(var(--green-rgb), .7); }
.value { font-size: var(--fs-12); color: var(--text-muted); }
.small-meta { font-size: var(--fs-10); color: rgba(var(--green-rgb), .7); }
.right-panel .listing-meta {
  font-size: var(--fs-10);
  opacity: .75;
  margin: var(--pad-6) 0;
}
.address { font-family: var(--font-mono); }
.traits-table { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: var(--pad-6); }
.traits-table .label { text-transform: uppercase; font-size: var(--fs-10); color: rgba(var(--green-rgb), .7); }

/* --- fix: left-align VIEW headline --- */
.left-panel .view-selector { display:flex; flex-direction:column; align-items:flex-start; }
.view-selector .panel-title { text-align:left !important; align-self:flex-start; margin-left:0; }

/* Menus */
.more-panel {
  position: absolute;
  right: 0;
  top: calc(100% + var(--pad-8));
  display: flex;
  flex-direction: column;
  gap: var(--pad-4);
  padding: var(--pad-8);
  background: var(--bg);
  border: 1px solid rgba(var(--green-rgb), .25);
  box-shadow: 0 0 20px rgba(0, 0, 0, .45);
  z-index: 200;
}
.more-panel[hidden] { display: none; }

/* Accessibility */
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
:focus-visible { outline: 2px solid rgba(var(--green-rgb), .5); outline-offset: 2px; }
.edge-group-header:focus-visible, .traits-header:focus-visible { box-shadow: 0 0 0 2px rgba(var(--green-rgb), .35); outline: none; }

/* Utility */
.hidden { display: none !important; }

@media (hover: hover) and (pointer: fine) {
  .tooltipped[data-tooltip] { position: relative; }
  .tooltipped[data-tooltip]::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + var(--pad-6));
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg);
    color: var(--fg);
    border: var(--border);
    padding: var(--pad-4) var(--pad-6);
    font-size: var(--fs-10);
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 160ms ease;
    z-index: 250;
  }
  .tooltipped[data-tooltip]::before {
    content: '';
    position: absolute;
    bottom: calc(100% + 2px);
    left: 50%;
    transform: translateX(-50%);
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--bg);
    opacity: 0;
    transition: opacity 160ms ease;
    pointer-events: none;
  }
  .tooltipped[data-tooltip]:hover::after,
  .tooltipped[data-tooltip]:focus-visible::after,
  .tooltipped[data-tooltip]:hover::before,
  .tooltipped[data-tooltip]:focus-visible::before { opacity: 1; }
}

/* Responsive */
@media (max-width: 1200px) {
  .header-controls { grid-template-columns: 1fr; }
  .header-actions { justify-content: flex-start; }
  .main-container { height: auto; min-height: calc(100dvh - 40px); }
}

@media (max-width: 1024px) {
  .main-container { grid-template-columns: 220px 1fr 320px; }
}

@media (max-width: 900px) {
  .header { grid-template-columns: var(--col-left) 1fr; grid-auto-rows: auto; height: auto; padding-bottom: var(--pad-8); }
  .header-controls { grid-column: 1 / -1; width: 100%; }
  .header-controls { grid-template-columns: 1fr; }
  .header-actions { justify-content: flex-start; }
  .main-container {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto 1fr;
  }
  .left-panel { order: 1; border-right: none; border-bottom: 1px solid rgba(var(--green-rgb), .2); }
  .center-panel { order: 2; min-height: 60vh; }
  .right-panel { order: 3; border-left: none; border-top: 1px solid rgba(var(--green-rgb), .2); }
}

@media (max-width: 768px) {
  :root { --ctl-h: 44px; }
  .header-controls { gap: var(--pad-12); }
  .btn, .preset-btn, .chip-btn, .clear-btn, .menu-item { padding: 0 var(--pad-16); }
}

@media (max-width: 600px) {
  .left-panel, .right-panel { display: none; }
  .header { grid-template-columns: 1fr; }
  .logo-wrap { padding: var(--pad-12); }
}
